pipeline{
    agent any
    tools {nodejs "node"}
    stages{
        stage('Clean Workspace'){
            steps{
                cleanWs()
            }
        }
            stage('Checkout'){
                steps{
                echo 'Checking out project from git'
                checkout scm
                dir('key'){
                echo 'Checking out api keys from git'
                echo "${WORKSPACE}"
                git branch: 'main',
                credentialsId: 'SHIKHARDEVOPSID',
                url: 'https://github.com/sshikhar1234/twitter-api-keys.git'
                }
                sh "xcopy ${WORKSPACE}\\key\\.env ${WORKSPACE} /E /H /R /X /Y /I /K"

                // fileOperations([fileCopyOperation(
                // excludes: '',
                // flattenFiles: false,
                // includes: 'key\\*.js',
                // targetLocation: "${WORKSPACE}"
                // )])
                }
            }
            stage('Build'){
                steps{
                echo 'Build running'
                sh 'npm start'
                }
            }
            stage('Test'){
                steps{
                echo 'Tests running'
                }
            }
            stage('Deploy'){
                steps{
                echo 'Deploying web app on cloud'
                echo 'Deployment Successful'
                }
            }
        }
    
}